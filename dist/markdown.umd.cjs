(function(i,r){typeof exports=="object"&&typeof module<"u"?module.exports=r():typeof define=="function"&&define.amd?define(r):(i=typeof globalThis<"u"?globalThis:i||self,i.markdown=r())})(this,function(){"use strict";var p=Object.defineProperty;var f=(i,r,u)=>r in i?p(i,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[r]=u;var h=(i,r,u)=>f(i,typeof r!="symbol"?r+"":r,u);class i{constructor(e){h(this,"cursor",0);h(this,"stream",null);h(this,"stack",[]);this.stream=e,this.cursor=e.cursor}positiveLookAhead(e){return this.stack.push(e===this.stream.raw.slice(this.cursor,this.cursor+e.length)),this.cursor+=e.length,this}negativeLookAhead(e){return this.stack.push(e!==this.stream.raw.slice(this.cursor,this.cursor+e.length)),this.cursor+=e.length,this}negativeLookBehind(e){return this.stack.push(e!==this.stream.raw.slice(this.cursor-e.length,this.cursor)),this.cursor-=e.length,this}get passed(){return this.stack.reduce((e,t)=>e&&t,!0)}}class r{constructor(e){h(this,"cursor",0);this.raw=e}get length(){return this.raw.length}get next(){return this.raw[this.cursor++]}get current(){return this.raw[this.cursor]}get end(){return this.cursor>=this.length}readUntil(e){const t=this.raw.slice(this.cursor),s=t.indexOf(e);if(s>-1){const a=t.slice(0,s);return this.cursor+=a.length,a}}positiveLookAhead(e){return new i(this).positiveLookAhead(e)}negativeLookAhead(e){return new i(this).negativeLookAhead(e)}negativeLookBehind(e){return new i(this).negativeLookBehind(e)}}class u{constructor({plugins:e={}}={}){h(this,"plugins",null);h(this,"ast",[]);this.plugins=e}render(e){const t=new r(e);let s;for(;!t.end;){let a=t.next;for(const o in this.plugins){const d=this.plugins[o];for(const n of d)if(n.mode=="match"){const c=t.negativeLookBehind(n.with.at(0)).passed,g=t.positiveLookAhead(n.with).negativeLookAhead(n.with.at(-1)).passed;c&&g&&(s||(s=Object.create(null),s.name=o,s.index=t.cursor+n.with.length+1),t.cursor+=n.with.length)}else if(n.mode==="eat"&&s){const c=Object.create(null);c.index=t.cursor+1,c.value=t.readUntil(n.until),c.end=t.cursor,s[n.name]=c,t.cursor+=n.until.length}if(s)break}if(s){const o=Object.create(null);o.name="ascii",o.value=a,o.index=t.cursor,this.ast.push(o)}else s=Object.create(null),s.name="ascii",s.value=a,s.index=t.cursor;this.ast.push(s),s=null}}}return u});
